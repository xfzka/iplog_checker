# ============================================================
# IPLog Checker é…ç½®æ–‡ä»¶ç¤ºä¾‹
# ============================================================
# æœ¬æ–‡ä»¶åŒ…å«æ‰€æœ‰å¯ç”¨é…ç½®é¡¹çš„è¯¦ç»†è¯´æ˜
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º config.yaml å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹

# ------------------------------------------------------------
# æ—¥å¿—é…ç½®
# ------------------------------------------------------------
logging:
  # æ—¥å¿—çº§åˆ«: debug, info, warn, error
  # é»˜è®¤å€¼: info
  level: "info"

  # æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œç•™ç©ºåˆ™åªè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º
  # é»˜è®¤å€¼: ç©º (åªè¾“å‡ºåˆ°æ§åˆ¶å°)
  to: "iplog_checker.log"

# ------------------------------------------------------------
# å®‰å…¨ IP åˆ—è¡¨é…ç½® (ç™½åå•)
# ------------------------------------------------------------
# æ”¯æŒä¸‰ç§æ¥æºæ–¹å¼ (ä¸‰é€‰ä¸€ï¼Œæ¯ä¸ªåˆ—è¡¨é¡¹åªèƒ½é€‰æ‹©ä¸€ç§):
#   1. ips: ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š IP æˆ– CIDR
#   2. file: ä»æœ¬åœ°æ–‡ä»¶åŠ è½½
#   3. url: ä»è¿œç¨‹ URL ä¸‹è½½
#
# ç™½åå•ä¸­çš„ IP ä¸ä¼šè¢«æ ‡è®°ä¸ºé£é™© IP
safe_list:
  # ç¤ºä¾‹1: ä½¿ç”¨ ips ç›´æ¥æŒ‡å®š (é€‚åˆå°‘é‡é™æ€ IP)
  - name: "LAN IP" # åˆ—è¡¨åç§° (å¿…å¡«ï¼Œç”¨äºæ—¥å¿—æ ‡è¯†)
    ips: # æ‰‹åŠ¨æŒ‡å®š IP åˆ—è¡¨ (æ”¯æŒå•ä¸ª IP æˆ– CIDR)
      - "192.168.0.0/16"
      - "10.0.0.0/8"
      - "172.16.0.0/12"
      - "127.0.0.1"

  # ç¤ºä¾‹2: ä½¿ç”¨ ips æŒ‡å®šè‡ªå·±çš„æœåŠ¡å™¨ IP
  - name: "my servers"
    ips:
      - "1.1.1.1"
      - "8.8.8.8"

  # ç¤ºä¾‹3: ä»æœ¬åœ°æ–‡ä»¶åŠ è½½ (é€‚åˆ IP åˆ—è¡¨è¾ƒå¤šæˆ–éœ€è¦åŠ¨æ€ç»´æŠ¤)
  # - name: "local whitelist"
  #   file: "/path/to/whitelist.txt"  # æœ¬åœ°æ–‡ä»¶è·¯å¾„ (å¿…å¡«ï¼Œä¸ ips/url ä¸‰é€‰ä¸€)
  #   format: "text"                   # æ–‡ä»¶æ ¼å¼: text, csv, json (é»˜è®¤: text)
  #   update_interval: "24h"           # æ›´æ–°é—´éš”ï¼Œæ”¯æŒ d/h/m/s (é»˜è®¤: 2h)
  #   # ä»¥ä¸‹ä¸º csv/json æ ¼å¼ä¸“ç”¨é…ç½®:
  #   # csv_column: "ip"               # CSV æ ¼å¼æ—¶çš„åˆ—å
  #   # json_path: "data.ips"          # JSON æ ¼å¼æ—¶çš„è·¯å¾„

  # ç¤ºä¾‹4: ä»è¿œç¨‹ URL ä¸‹è½½ (é€‚åˆä½¿ç”¨ç¬¬ä¸‰æ–¹ç™½åå•)
  # - name: "cloud whitelist"
  #   url: "https://example.com/whitelist.txt"  # è¿œç¨‹ URL (å¿…å¡«ï¼Œä¸ ips/file ä¸‰é€‰ä¸€)
  #   format: "text"                   # æ–‡ä»¶æ ¼å¼: text, csv, json (é»˜è®¤: text)
  #   update_interval: "24h"           # æ›´æ–°é—´éš”ï¼Œæ”¯æŒ d/h/m/s (é»˜è®¤: 2h)
  #   timeout: "30s"                   # è¯·æ±‚è¶…æ—¶ï¼Œæ”¯æŒ h/m/s (é»˜è®¤: 30s)
  #   retry_count: 3                   # è¯·æ±‚å¤±è´¥é‡è¯•æ¬¡æ•° (é»˜è®¤: 3)
  #   custom_headers:                  # è‡ªå®šä¹‰ HTTP è¯·æ±‚å¤´ (å¯é€‰)
  #     Authorization: "Bearer xxx"

# ------------------------------------------------------------
# é£é™© IP åˆ—è¡¨é…ç½®
# ------------------------------------------------------------
# æ”¯æŒä¸‰ç§æ¥æºæ–¹å¼ (ä¸‰é€‰ä¸€ï¼Œæ¯ä¸ªåˆ—è¡¨é¡¹åªèƒ½é€‰æ‹©ä¸€ç§):
#   1. ips: ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š IP æˆ– CIDR
#   2. file: ä»æœ¬åœ°æ–‡ä»¶åŠ è½½
#   3. url: ä»è¿œç¨‹ URL ä¸‹è½½
#
# æ—¥å¿—ä¸­å‡ºç°çš„ IP å¦‚æœåŒ¹é…é£é™©åˆ—è¡¨ï¼Œå°†è§¦å‘å‘Šè­¦é€šçŸ¥
risk_list:
  # ç¤ºä¾‹1: ä½¿ç”¨çŸ¥åå¨èƒæƒ…æŠ¥æº - stamparm/ipsum level 8 (æœ€é«˜é£é™©)
  - name: "stamparm_ipsum_level8"
    url: "https://github.com/stamparm/ipsum/raw/refs/heads/master/levels/8.txt"
    update_interval: "6h" # æ›´æ–°é—´éš”ï¼Œæ”¯æŒ d/h/m/s (é»˜è®¤: 2h)
    format: "text" # æ–‡ä»¶æ ¼å¼: text, csv, json (é»˜è®¤: text)
    timeout: "30s" # è¯·æ±‚è¶…æ—¶ï¼Œæ”¯æŒ h/m/s (é»˜è®¤: 30s)
    retry_count: 3 # è¯·æ±‚å¤±è´¥é‡è¯•æ¬¡æ•° (é»˜è®¤: 3)

  # ç¤ºä¾‹2: stamparm/ipsum level 7
  - name: "stamparm_ipsum_level7"
    url: "https://github.com/stamparm/ipsum/raw/refs/heads/master/levels/7.txt"
    update_interval: "6h"
    format: "text"
    timeout: "30s"
    retry_count: 3

  # ç¤ºä¾‹3: æ‰‹åŠ¨æŒ‡å®šé£é™© IP
  # - name: "manual risk IPs"
  #   ips:
  #     - "203.0.113.0/24"           # æ”¯æŒ CIDR
  #     - "198.51.100.1"             # æ”¯æŒå•ä¸ª IP

  # ç¤ºä¾‹4: ä»æœ¬åœ°æ–‡ä»¶åŠ è½½é£é™© IP
  # - name: "local blacklist"
  #   file: "/path/to/blacklist.txt"
  #   format: "text"
  #   update_interval: "1h"

# ------------------------------------------------------------
# ç›‘æ§çš„ç›®æ ‡æ—¥å¿—æ–‡ä»¶
# ------------------------------------------------------------
target_logs:
  # ç¤ºä¾‹1: tail æ¨¡å¼ - æŒç»­ç›‘æ§æ—¥å¿—æ–‡ä»¶æ–°å¢å†…å®¹
  - name: "nginx_access" # æ–‡ä»¶åç§° (ç”¨äºæ—¥å¿—æ ‡è¯†å’Œé€šçŸ¥)
    path: "/var/log/nginx/access.log" # æ—¥å¿—æ–‡ä»¶è·¯å¾„ (å¿…å¡«)
    read_mode:
      "tail" # è¯»å–æ¨¡å¼: tail (æŒç»­ç›‘æ§), once (ä¸€æ¬¡æ€§)
      # é»˜è®¤å€¼: once

  # ç¤ºä¾‹2: once æ¨¡å¼ - å®šæ—¶ä¸€æ¬¡æ€§è¯»å–æ•´ä¸ªæ–‡ä»¶
  - name: "fail2ban_log"
    path: "/var/log/fail2ban.log"
    read_mode: "once" # ä¸€æ¬¡æ€§è¯»å–æ¨¡å¼
    read_interval:
      "24h" # è¯»å–é—´éš”ï¼Œæ”¯æŒ d/h/m/s (é»˜è®¤: 2h)
      # ä»… once æ¨¡å¼æœ‰æ•ˆ
    clean_after_read:
      false # è¯»å–åæ˜¯å¦æ¸…ç©ºæ–‡ä»¶ (é»˜è®¤: false)
      # ä»… once æ¨¡å¼æœ‰æ•ˆ

  # ç¤ºä¾‹3: è¯»å–åæ¸…ç©ºæ–‡ä»¶ (é€‚åˆä¸´æ—¶æ—¥å¿—)
  # - name: "temp_alerts"
  #   path: "/var/log/alerts.tmp"
  #   read_mode: "once"
  #   read_interval: "1h"
  #   clean_after_read: true         # è¯»å–åæ¸…ç©ºæ–‡ä»¶

# ------------------------------------------------------------
# é€šçŸ¥é…ç½®
# ------------------------------------------------------------
# å½“æ£€æµ‹åˆ°é£é™© IP è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå‘é€é€šçŸ¥
# æ”¯æŒå¤šç§é€šçŸ¥æœåŠ¡ï¼Œå¯åŒæ—¶é…ç½®å¤šä¸ª
notifications:
  # å…¨å±€è¯·æ±‚è¶…æ—¶è®¾ç½®
  # é»˜è®¤å€¼: 10s
  timeout: "10s"

  # å…¨å±€é‡è¯•æ¬¡æ•°è®¾ç½®
  # é»˜è®¤å€¼: 5
  retry_count: 5

  # é€šçŸ¥æœåŠ¡åˆ—è¡¨
  services:
    # ========================================
    # 1. Webhook (è‡ªå®šä¹‰ HTTP è¯·æ±‚)
    # ========================================
    # é€‚ç”¨äº: è‡ªå®šä¹‰å‘Šè­¦ç³»ç»Ÿã€ä¼ä¸šå†…éƒ¨ç³»ç»Ÿå¯¹æ¥
    - service: "webhook"
      threshold:
        5 # è§¦å‘é€šçŸ¥çš„é˜ˆå€¼ (åŒä¸€ IP å‘½ä¸­æ¬¡æ•°)
        # é»˜è®¤å€¼: 5
      # æ¶ˆæ¯æ¨¡æ¿ (ä½¿ç”¨ Go æ¨¡æ¿è¯­æ³•)
      # å¯ç”¨å˜é‡:
      #   {{.IP}}        - é£é™© IP åœ°å€
      #   {{.Count}}     - å‘½ä¸­æ¬¡æ•°
      #   {{.Source}}    - æ¥æºæ—¥å¿—æ–‡ä»¶å
      #   {{.Timestamp}} - Unix æ—¶é—´æˆ³
      #   {{.Time}}      - æ ¼å¼åŒ–æ—¶é—´ (2006-01-02 15:04:05)
      payload_template: '{"alert": "Risk IP detected", "ip": "{{.IP}}", "count": {{.Count}}, "source": "{{.Source}}", "timestamp": "{{.Timestamp}}", "time": "{{.Time}}" }'
      config:
        url: "https://example.com/alert_endpoint" # Webhook URL (å¿…å¡«)
        headers: # è‡ªå®šä¹‰ HTTP è¯·æ±‚å¤´ (å¯é€‰)
          Content-Type: "application/json"
          Authorization: "Bearer your_token"

    # ========================================
    # 2. Slack
    # ========================================
    # é€‚ç”¨äº: ä½¿ç”¨ Slack çš„å›¢é˜Ÿ
    # - service: "slack"
    #   threshold: 5
    #   payload_template: "ğŸš¨ Risk IP Alert: {{.IP}} ({{.Count}} hits) from {{.Source}} at {{.Time}}"
    #   config:
    #     token: "xoxb-your-slack-bot-token"       # Slack Bot Token (å¿…å¡«)
    #     channel: "#security-alerts"              # ç›®æ ‡é¢‘é“ (å¿…å¡«)

    # ========================================
    # 3. Discord
    # ========================================
    # é€‚ç”¨äº: ä½¿ç”¨ Discord çš„å›¢é˜Ÿ
    # - service: "discord"
    #   threshold: 5
    #   payload_template: "ğŸš¨ Risk IP Alert: {{.IP}} ({{.Count}} hits) from {{.Source}}"
    #   config:
    #     token: "your-discord-bot-token"          # Discord Bot Token (å¿…å¡«)
    #     channel: "channel_id"                    # ç›®æ ‡é¢‘é“ ID (å¿…å¡«)

    # ========================================
    # 4. Telegram
    # ========================================
    # é€‚ç”¨äº: éœ€è¦ç§»åŠ¨ç«¯æ¨é€çš„ç”¨æˆ·
    # - service: "telegram"
    #   threshold: 5
    #   payload_template: "ğŸš¨ Risk IP Alert\nIP: {{.IP}}\nHits: {{.Count}}\nSource: {{.Source}}\nTime: {{.Time}}"
    #   config:
    #     token: "your-telegram-bot-token"         # Telegram Bot Token (å¿…å¡«)
    #     chat_id: "123456789"                     # ç›®æ ‡ Chat ID (å¿…å¡«ï¼Œå­—ç¬¦ä¸²æ ¼å¼)

    # ========================================
    # 5. Bark (iOS æ¨é€)
    # ========================================
    # é€‚ç”¨äº: iOS ç”¨æˆ·ï¼Œéœ€è¦å®‰è£… Bark App
    # - service: "bark"
    #   threshold: 5
    #   payload_template: "Risk IP: {{.IP}} ({{.Count}} hits) - {{.Source}}"
    #   config:
    #     key: "your-bark-device-key"              # Bark Device Key (å¿…å¡«)

    # ========================================
    # 6. Pushover
    # ========================================
    # é€‚ç”¨äº: éœ€è¦è·¨å¹³å°æ¨é€é€šçŸ¥çš„ç”¨æˆ·
    # - service: "pushover"
    #   threshold: 5
    #   payload_template: "Risk IP {{.IP}} detected {{.Count}} times from {{.Source}}"
    #   config:
    #     token: "your-pushover-api-token"         # Pushover API Token (å¿…å¡«)
    #     user_key: "your-pushover-user-key"       # Pushover User Key (å¿…å¡«)

    # ========================================
    # 7. Pushbullet
    # ========================================
    # é€‚ç”¨äº: éœ€è¦å¤šè®¾å¤‡åŒæ­¥é€šçŸ¥çš„ç”¨æˆ·
    # - service: "pushbullet"
    #   threshold: 5
    #   payload_template: "Risk IP Alert: {{.IP}} - {{.Count}} hits"
    #   config:
    #     token: "your-pushbullet-access-token"    # Pushbullet Access Token (å¿…å¡«)
    #     device_id: "device_id"                   # ç›®æ ‡è®¾å¤‡ ID (å¯é€‰ï¼Œä¸ºç©ºåˆ™æ¨é€åˆ°æ‰€æœ‰è®¾å¤‡)

    # ========================================
    # 8. RocketChat
    # ========================================
    # é€‚ç”¨äº: ä½¿ç”¨ Rocket.Chat çš„å›¢é˜Ÿ
    # - service: "rocketchat"
    #   threshold: 5
    #   payload_template: "ğŸš¨ Risk IP: {{.IP}} detected {{.Count}} times"
    #   config:
    #     url: "your-rocketchat-server.com"        # Rocket.Chat æœåŠ¡å™¨åœ°å€ (å¿…å¡«)
    #     scheme: "https"                          # åè®®: http æˆ– https (é»˜è®¤: https)
    #     user_id: "your-user-id"                  # ç”¨æˆ· ID (å¿…å¡«)
    #     token: "your-auth-token"                 # è®¤è¯ Token (å¿…å¡«)
    #     channel: "#security"                     # ç›®æ ‡é¢‘é“ (å¿…å¡«)

    # ========================================
    # 9. WeChat (å¾®ä¿¡å…¬ä¼—å·/ä¼ä¸šå¾®ä¿¡)
    # ========================================
    # é€‚ç”¨äº: ä¸­å›½åŒºç”¨æˆ·
    # - service: "wechat"
    #   threshold: 5
    #   payload_template: "é£é™©IPå‘Šè­¦\nIP: {{.IP}}\næ¬¡æ•°: {{.Count}}\næ¥æº: {{.Source}}\næ—¶é—´: {{.Time}}"
    #   config:
    #     app_id: "your-wechat-app-id"             # å¾®ä¿¡ App ID (å¿…å¡«)
    #     app_secret: "your-wechat-app-secret"     # å¾®ä¿¡ App Secret (å¿…å¡«)
    #     open_id: "target-user-open-id"           # ç›®æ ‡ç”¨æˆ· OpenID (å¿…å¡«)

    # ========================================
    # 10. WebPush (æµè§ˆå™¨æ¨é€)
    # ========================================
    # é€‚ç”¨äº: Web åº”ç”¨é›†æˆ
    # - service: "webpush"
    #   threshold: 5
    #   payload_template: "Risk IP: {{.IP}} detected"
    #   config:
    #     vapid_public_key: "your-vapid-public-key"    # VAPID å…¬é’¥ (å¿…å¡«)
    #     vapid_private_key: "your-vapid-private-key"  # VAPID ç§é’¥ (å¿…å¡«)
